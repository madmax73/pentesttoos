var customers = [{
    id: 1,
    Name: "Allianz",
    Country: "Germany",
    Relevance: 7,
    img: "wp-content/themes/twentytwentyone/images/customers/Allianz.svg",
    Industry: "Banking & Finance",
},
{
    id: 2,
    Name: "Deloitte",
    Country: "United Kingdom",
    Relevance: 7,
    img: "wp-content/themes/twentytwentyone/images/customers/deloitte.svg",
    Industry: "Audit & Advisory",
}, {
    id: 3,
    Name: "Cathay United Bank",
    Country: "China",
    Relevance: 1,
    img: "wp-content/themes/twentytwentyone/images/customers/Cathay_United_Bank_logo.svg",
    Industry: "Banking & Finance",
}, {
    id: 4,
    Name: "Intel",
    Country: "United States of America",
    Relevance: 10,
    img: "wp-content/themes/twentytwentyone/images/customers/Intel.svg",
    Industry: "Technology & Telecom",
}, {
    id: 5,
    Name: "Yale University",
    Country: "United States of America",
    Relevance: 10,
    img: "wp-content/themes/twentytwentyone/images/customers/Yale_University.svg",
    Industry: "Education",
}, {
    id: 6,
    Name: "Orange",

    Country: "France",
    Relevance: 9,
    img: "wp-content/themes/twentytwentyone/images/customers/orange.svg",
    Industry: "Technology & Telecom",
}, {
    id: 7,
    Name: "Johnson & Johnson",

    Country: "United Kingdom",
    Relevance: 8,
    img: "wp-content/themes/twentytwentyone/images/customers/Johnson_and_Johnson_Logo.svg",
    Industry: "Healthcare",
}, {
    id: 8,
    Name: "Vodafone",

    Country: "United Kingdom",
    Relevance: 9,
    img: "wp-content/themes/twentytwentyone/images/customers/Vodafone_2017_logo.svg",
    Industry: "Technology & Telecom",
}, {
    id: 9,
    Name: "Accenture",

    Country: "United Kingdom",
    Relevance: 7,
    img: "wp-content/themes/twentytwentyone/images/customers/Accenture.svg",
    Industry: "Audit & Advisory",
}, {
    id: 10,
    Name: "U.S. Department of Commerce",

    Country: "United States of America",
    Relevance: 10,
    img: "wp-content/themes/twentytwentyone/images/customers/u-s-department-of-commerce.svg",
    Industry: "Gov & Public Sector",

},
];

function toggleHidden() {
    var searchEles = document.getElementById("filters").children;
    var element = document.getElementById("filters");
    element.classList.toggle("hiddenImp");

    for (var i = 0; i < searchEles.length; i++) {
        if (!searchEles[i].children[2].classList.contains("hidden")) {
            searchEles[i].children[2].classList.toggle("hidden")
        }
    };
};
function toggleHidden1() {
    var element = document.getElementById("ptt-listbox-options-14");
    element.classList.toggle("hidden");
};
function toggleHidden2() {
    var element = document.getElementById("ptt-listbox-options-17");
    element.classList.toggle("hidden");
};

function toggleHidden3() {
    var element = document.getElementById("ptt-listbox-options-11");
    element.classList.toggle("hidden");
};


window.addEventListener("DOMContentLoaded", function () {
    customers = customers.sort(sort_by("Relevance",true))
    buttonInd = document.querySelector("#ptt-listbox-button-13 span");
    buttonCountr = document.querySelector("#ptt-listbox-button-16 span");
    buttonOrderby = document.querySelector("#ptt-listbox-button-10");
    popups = document.querySelectorAll("[role='listbox']");
    container = document.querySelector(".customCont");
    listofIndustries = document.getElementById("ptt-listbox-options-14");
    listofCountries = document.getElementById("ptt-listbox-options-17");
    sortContainer = document.getElementById("ptt-listbox-options-11");
    sortList = ["Relevance", "Alphabetical"];
    sortType = new Boolean(true)
    array = ["All industries", "All countries","Relevance"];
    val3 = "Relevance"
    filterMenu("All industries", "All countries")

    var industry = customers.reduce(function (values, items) {
        if (!values.includes(items.Industry)) {
            values.push(items.Industry);
        }
        return values;
    }, ["All industries"]);

    var countries = customers.reduce(function (values, items) {
        if (!values.includes(items.Country)) {
            values.push(items.Country);
        }
        return values;
    }, ["All countries"]);
    // populate industries list 
    var industries = industry.map(function (item) {
        return `
        <li id="ptt-listbox-option-79" role="option" tabindex="-1" aria-selected="false" class="flex w-full cursor-pointer items-center justify-between px-3 py-2 text-left text-sm focus:outline-none text-gray-700">
            ${item}
            
        </li>`;
    });
    var industriesList = industries.join("")
    listofIndustries.innerHTML = industriesList;
    // populate countries list 
    var countries = countries.map(function (item) {
        return `
        <li id="ptt-listbox-option-79" role="option" tabindex="-1" aria-selected="false" class="flex w-full cursor-pointer items-center justify-between px-3 py-2 text-left text-sm focus:outline-none text-gray-700">
            ${item}            
        </li>`;
    });
    var countriesList = countries.join("")
    listofCountries.innerHTML = countriesList;
    // populate order by list
    var orderBy = sortList.map(function (item) {
        return `
        <li id="ptt-listbox-option-79" role="option" tabindex="-1" aria-selected="false" class="flex w-full cursor-pointer items-center justify-between px-3 py-2 text-left text-sm focus:outline-none text-gray-700">
            ${item}            
        </li>`;
    });
    var orderBylist = orderBy.join("")
    sortContainer.innerHTML = orderBylist;

    button = document.getElementById("ptt-listbox-options-14");
    button2 = document.getElementById("ptt-listbox-options-17");
    button3 = document.getElementById("ptt-listbox-options-11");

    for (var i = 0; i < button.childElementCount; i++) {
        button.children[i].addEventListener("click", (e) => {
            val = e.target.innerText;
            array[0] = val
            filter(array)
        });
    }

    for (var i = 0; i < button2.childElementCount; i++) {
        button2.children[i].addEventListener("click", (e) => {
            val2 = e.target.innerText;
            array[1] = val2
            filter(array)
        });
    }

    for (var i = 0; i < button3.childElementCount; i++) {
        button3.children[i].addEventListener("click", (e) => {
            val3 = e.target.innerText;
            if (val3 === "Alphabetical") {
                
                val3 = "Name";            
                customers = customers.sort(sort_by(val3,sortType))
                array[2] = "Alphabetical"
                filter(array)
                
            } else {                
                customers = customers.sort(sort_by(val3,sortType))
                array[2] = val3
                filter(array)
                
            }
            
        });
    }
    


});

function changeSortby(){
    sortType = !sortType;    
    customers = customers.sort(sort_by(val3,sortType))
    filter(array)
}

function filter(array) {
    filterMenu(array[0], array[1], array[2])
}
function displayMenu(customers) {

    var displayMenu = customers.map(function (item) {
        return (
            `<li class="flex items-center justify-center rounded bg-white shadow-md shadow-dark-blue-500/50"><img src="${item.img}" alt="Logo of ${item.Name} a Pentest-Tools.com customer" title="${item.Name} is a Pentest-Tools.com customer" loading="lazy" width="215" height="60" class="h-auto max-h-12 w-full object-scale-down p-8"></li>`)
    })
    displayMenu = displayMenu.join("");
    container.innerHTML = displayMenu;

    counter = 0;
    for (let i = 0; i < 2; i++) {
        if (!array[i].includes("All")) counter++;
    }
    buttonInd.innerText = array[0]
    buttonCountr.innerText = array[1];
    buttonOrderby.innerText = array[2];
    // buttonOrderby.innerText = array[2];
    if (counter > 0) {
        document.querySelector(".closeFilters").style.display = "block";
        document.querySelector(".filterbtn").innerHTML = `
        <svg data-id="heroicon-solid" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="-ml-1 flex-shrink-0 text-dark-blue-400">
            <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd">

            </path>
        </svg>
        <span>
            ${counter} Filters
        </span>`
        document.querySelector(".filterbtn").classList.add('rounded-l-md')
        document.querySelector(".filterbtn").classList.remove('rounded-md')
    }
    else {
        document.querySelector(".closeFilters").style.display = "none";
        document.querySelector(".filterbtn").innerHTML = `
        <svg data-id="heroicon-solid" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="-ml-1 flex-shrink-0 text-dark-blue-400">
            <path fill-rule="evenodd" d="M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z" clip-rule="evenodd">

            </path>
        </svg>
        <span>
            Filters
        </span>`;
        document.querySelector(".filterbtn").classList.add('rounded-md')
    }



}

// filter function
function filterMenu(Industry, Country) {
    // customers.sort(sort_by(OrderBy));
    var filter1 = customers.filter(element => {
        return element.Industry === Industry && element.Country === Country;
    })
    var filter2 = customers.filter(element => {
        return element.Industry === Industry;
    })
    var filter3 = customers.filter(element => {
        return element.Country === Country;
    })
    if (Industry === "All industries" && Country === "All countries") {
        displayMenu(customers);
    }
    else if (Industry === Industry && Country === "All countries") {
        displayMenu(filter2);
    }
    else if (Industry === "All industries" && Country === Country) {
        displayMenu(filter3);
    }
    else {
        displayMenu(filter1);
    }
}

// disable filters
function closeFilters() {
    document.querySelector(".closeFilters").style.display = "none";
    array = ["All industries", "All countries",array[2]]
    filter(array);
}


// window.addEventListener('click', ({ target }) => {
// //   const popup = target.closest('.popup');
// //   const clickedOnClosedPopup = popup && !popup.classList.contains('show');


//     popups.forEach(closeList);
//     function closeList(popup) {
//         if (popup.classList.contains("hidden")){
//             console.log("True")
//         }
//         else{
//             return popup.classList.add('hidden')
//         }
// }
// //   if (clickedOnClosedPopup) popup.classList.add('show');  
// });
const sort_by = (field, reverse, primer) => {

    const key = primer ?
        function (x) {
            return primer(x[field]);
        } :
        function (x) {
            return x[field];
        };

    reverse = !reverse ? 1 : -1;

    return function (a, b) {
        return a = key(a), b = key(b), reverse * ((a > b) - (b > a));
    };
};